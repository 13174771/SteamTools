<?xml version="1.0" encoding="utf-8" ?>
<TabbedPage xmlns="http://xamarin.com/schemas/2014/forms"
            xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
            xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
            xmlns:d="http://xamarin.com/schemas/2014/forms/design"
            xmlns:converters="clr-namespace:System.Application.Converters;assembly=System.Application.SteamTools.Client.Mobile"
            xmlns:ccl_services="clr-namespace:System.Application.Services;assembly=System.Application.SteamTools.Client"
            xmlns:resx="clr-namespace:System.Application.UI.Resx"
            xmlns:viewmodels="clr-namespace:System.Application.UI.ViewModels"
            xmlns:controls="clr-namespace:System.Application.UI.Views.Controls;assembly=System.Application.SteamTools.Client.Mobile"
            xmlns:android="clr-namespace:Xamarin.Forms.PlatformConfiguration.AndroidSpecific;assembly=Xamarin.Forms.Core"
            x:DataType="viewmodels:LoginOrRegisterPageViewModel"
            mc:Ignorable="d"
            android:TabbedPage.ToolbarPlacement="Top"
            x:Class="System.Application.UI.Views.LoginOrRegisterPage"
            Title="{Binding Title}"
            Shell.NavBarIsVisible="True">
  <TabbedPage.Resources>
    <ControlTemplate x:Key="AgreementAndPrivacy">
      <Label HorizontalOptions="Center" BindingContext="{Binding Path=., Source={RelativeSource AncestorType={x:Type viewmodels:LoginOrRegisterPageViewModel}}}">
        <Label.FormattedText>
          <FormattedString>
            <FormattedString.Spans>
              <Span Text="{x:Static resx:AppResources.User_RegisterAgreed}"/>
              <Span Text=" "/>
              <Span Text="{x:Static resx:AppResources.User_Agreement}"
                        Style="{DynamicResource LinkText}">
                <Span.GestureRecognizers>
                  <TapGestureRecognizer Command="{Binding OpenHyperlink}"
                                          CommandParameter="Agreement"/>
                </Span.GestureRecognizers>
              </Span>
              <Span Text=" "/>
              <Span Text="{x:Static resx:AppResources.And}"/>
              <Span Text=" "/>
              <Span Text="{x:Static resx:AppResources.User_Privacy}"
                        Style="{DynamicResource LinkText}">
                <Span.GestureRecognizers>
                  <TapGestureRecognizer Command="{Binding OpenHyperlink}"
                                          CommandParameter="Privacy"/>
                </Span.GestureRecognizers>
              </Span>
            </FormattedString.Spans>
          </FormattedString>
        </Label.FormattedText>
      </Label>
    </ControlTemplate>
    <converters:LoginOrRegisterChannelTextConverter x:Key="LoginOrRegisterChannelTextConverter"/>
    <converters:PathIconConverter x:Key="PathIconConverter"/>
    <converters:LoginOrRegisterChannelBackgroundColorConverter x:Key="LoginOrRegisterChannelBackgroundColorConverter"/>
  </TabbedPage.Resources>
  <TabbedPage.Children>
    <ContentPage Title="{x:Static resx:AppResources.User_FastLogin}"
                 BackgroundColor="{DynamicResource WindowBackground}">
      <ContentPage.Content>
        <ScrollView>
          <NavigationPage.TitleView>
            <Slider HeightRequest="44" WidthRequest="300" />
          </NavigationPage.TitleView>
          <StackLayout VerticalOptions="CenterAndExpand">
            <Label Padding="22" FontSize="17" Text="{x:Static resx:AppResources.User_FastLoginTip}"/>
            <StackLayout BindableLayout.ItemsSource="{Binding Channels}">
              <BindableLayout.ItemTemplate>
                <DataTemplate>
                  <ContentView VerticalOptions="CenterAndExpand">
                    <controls:CardButton Padding="0" 
                                         Margin="22,0,22,22"  
                                         CommandParameter="{Binding}"  
                                         Command="{Binding Path=ChooseChannel, Source={RelativeSource AncestorType={x:Type viewmodels:LoginOrRegisterPageViewModel}}}">
                      <StackLayout Orientation="Horizontal">
                        <ContentView Padding="16" 
                                     BackgroundColor="{Binding Converter={StaticResource LoginOrRegisterChannelBackgroundColorConverter}}">
                          <Path Style="{DynamicResource PathIcon}" 
                                Data="{Binding Converter={StaticResource PathIconConverter}}"/>
                        </ContentView>
                        <Label Margin="16" FontSize="20">
                          <Label.Text>
                            <MultiBinding Converter="{StaticResource LoginOrRegisterChannelTextConverter}">
                              <Binding Source="{x:Static resx:AppResources.User_UseFastLoginChannel_}"/>
                              <Binding Path="."/>
                              <Binding Source="{x:Static resx:AppResources.User_UsePhoneNumLoginChannel}"/>
                            </MultiBinding>
                          </Label.Text>
                        </Label>
                      </StackLayout>
                    </controls:CardButton>
                  </ContentView>
                </DataTemplate>
              </BindableLayout.ItemTemplate>
            </StackLayout>
            <ContentView Margin="0,0,0,22" ControlTemplate="{StaticResource AgreementAndPrivacy}"/>
          </StackLayout>
        </ScrollView>
        <!--<CollectionView ItemsSource="{Binding FastLoginChannels}" HeightRequest="450" VerticalOptions="CenterAndExpand">
          <CollectionView.Header>
            <Label Padding="22" FontSize="16" Text="{x:Static resx:AppResources.User_FastLoginTip}"/>
          </CollectionView.Header>
          <CollectionView.Footer>
            <ContentView Margin="0,0,0,22" ControlTemplate="{StaticResource AgreementAndPrivacy}"/>
          </CollectionView.Footer>
          <CollectionView.ItemTemplate>
            <DataTemplate x:DataType="st_root:FastLoginChannel">
              <ContentView>
                <Frame Padding="16" Margin="22,0,22,22">
                  <Frame.GestureRecognizers>
                    <TapGestureRecognizer CommandParameter="{Binding}"
                                          Command="{Binding Path=FastLogin, Source={RelativeSource AncestorType={x:Type viewmodels:LoginOrRegisterPageViewModel}}}"/>
                  </Frame.GestureRecognizers>
                  <StackLayout Spacing="16">
                    <Label Text="{Binding}"
                           FontSize="24"/>
                  </StackLayout>
                </Frame>
              </ContentView>
            </DataTemplate>
          </CollectionView.ItemTemplate>
        </CollectionView>-->
      </ContentPage.Content>
    </ContentPage>
    <ContentPage Title="{x:Static resx:AppResources.User_PhoneLogin}"
                 BackgroundColor="{DynamicResource WindowBackground}">
      <ContentPage.Content>
        <ScrollView>
          <StackLayout Orientation="Vertical">
            <ActivityIndicator IsRunning="True"
                           IsVisible="False"
                           Color="{StaticResource Primary}"
                           VerticalOptions="CenterAndExpand"/>
            <Grid Margin="22,42" IsVisible="True" VerticalOptions="CenterAndExpand">
              <Grid.RowDefinitions>
                <RowDefinition Height="192"/>
                <RowDefinition Height="56"/>
                <RowDefinition Height="56"/>
                <RowDefinition Height="56"/>
                <RowDefinition Height="*"/>
              </Grid.RowDefinitions>
              <Grid.ColumnDefinitions>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="106"/>
              </Grid.ColumnDefinitions>
              <Image Scale="2" Source="splash_logo.png" Grid.ColumnSpan="2"/>
              <controls:TextBox x:Name="TbPhoneNumber"
                            ReturnType="Next"
                            Margin="0,0,0,10"
                            Placeholder="{x:Static resx:AppResources.User_Phone}"
                            Keyboard="Telephone"
                            MaxLength="{Binding Path=PhoneNumber, Mode=OneTime, Source={x:Static ccl_services:InputLengthConstants.Current}}"
                            Grid.Row="1"
                            Grid.ColumnSpan="2"/>
              <controls:TextBox x:Name="TbSmsCode"
                            ReturnType="Done"
                            Margin="0,0,0,10"
                            Placeholder="{x:Static resx:AppResources.User_SMSCode}"
                            MaxLength="{Binding Path=SMS_CAPTCHA, Mode=OneTime, Source={x:Static ccl_services:InputLengthConstants.Current}}"
                            Keyboard="Numeric"
                            Grid.Row="2"
                            Grid.ColumnSpan="2"/>
              <controls:TextButton Margin="0,0,0,8"
                               Text="{Binding BtnSendSmsCodeText}"
                               Grid.Row="2"
                               Grid.Column="1"
                               Command="{Binding SendSms}"/>
              <Button Margin="0,0,0,12"
                  Text="{x:Static resx:AppResources.LoginAndRegister}"
                  Command="{Binding Submit}"
                  Grid.Row="3"
                  Grid.ColumnSpan="2"/>
              <ContentView Margin="0,0,0,32" Grid.Row="4" Grid.ColumnSpan="2" ControlTemplate="{StaticResource AgreementAndPrivacy}"/>
            </Grid>
          </StackLayout>
        </ScrollView>
      </ContentPage.Content>
    </ContentPage>
  </TabbedPage.Children>
</TabbedPage>
